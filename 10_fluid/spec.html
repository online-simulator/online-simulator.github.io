<!DOCTYPE html>

<html lang="ja">

<head>
  <meta charset="utf-8">
  <meta name="description" content="[spec]Incompressible flow">
  <meta name="author" content="online-simulator.github.io">
  <noscript>JavaScript is not enabled on browser.</noscript>
  <link rel="stylesheet" type="text/css" href="../00_common/css/common.css">
  <link rel="stylesheet" type="text/css" href="../00_common/css/color.css">
  <link rel="stylesheet" type="text/css" href="../00_common/css/size.css">
  <link rel="stylesheet" type="text/css" href="css/common.css">
  <link rel="stylesheet" type="text/css" href="css/color.css">
  <link rel="stylesheet" type="text/css" href="css/size.css">
</head>

<body>
  <div class="absolute">
    <table class="border">
      <caption><span class="selection"><a href="../03_solver">[test]solver</a>の応用例（解法のstep1）</span></caption>
      <thead>
        <tr class="border">
          <th class="border">
項目
          </th>
          <th class="border">
内容
          </th>
          <th class="border">
実装
          </th>
        </tr>
      </thead>
      <tbody>
        <tr class="border">
          <td class="border">
対象
          </td>
          <td class="border">
流体流れの数値simulation
          </td>
          <td class="border">
解の厳密さよりcodeの簡潔さを優先
          </td>
        </tr>
        <tr class="border">
          <td class="border" rowspan="3">
流体の種類
          </td>
          <td class="border">
実在の粘性流体
          </td>
          <td class="border">
非圧縮性のNewton流体を想定
<br>
・Mach数&lt;0.3
<br>
・動粘度=粘性係数/密度=const.
          </td>
        </tr>
        <tr class="border">
          <td class="border">
完全流体（非粘性の流体）
          </td>
          <td class="border">
Re無限大を想定
          </td>
        </tr>
        <tr class="border">
          <td class="border">
理想流体（非圧縮性の完全流体）
          </td>
          <td class="border">
通常、完全流体と同義
          </td>
        </tr>
        <tr class="border">
          <td class="border">
保存則
          </td>
          <td class="border">
無次元のNavier-Stokes方程式
<br>
無次元の連続の式（質量保存の式）
          </td>
          <td class="border">
直接、連立方程式のJacobi行列を構成して反復法で解くのは困難であり、
<br>
圧力の楕円型方程式を構成する等、安定な解法が工夫される
          </td>
        </tr>
        <tr class="border">
          <td class="border selection">
解法
          </td>
          <td class="border">
Fractional Step法（FS法）
          </td>
          <td class="border">
step0: 現在の時間stepの未知変数を更新
<br>
step0.5: 非線形な移流拡散方程式から中間速度を陽的に算出
<br>
<span class="selection">step1: 線形な連立方程式から次の時間stepの未知変数を陰的に求解</span>
          </td>
        </tr>
        <tr class="border">
          <td class="border selection">
solver@step1
          </td>
          <td class="border">
<a href="../01_calc_simple/manual.html#span-out-linear">Gaussの消去法</a>
          </td>
          <td class="border">
memory使用量と処理時間の大半を占有
          </td>
        </tr>
        <tr class="border">
          <td class="border">
格子||grid
          </td>
          <td class="border">
2次元等間隔直交格子
          </td>
          <td class="border">
client座標(x,y)を規格化
          </td>
        </tr>
        <tr class="border">
          <td class="border">
解像度
          </td>
          <td class="border">
格子sizeに反比例
          </td>
          <td class="border">
直接計算（DNS）の場合、最小単位の渦を解像可能な大きさ
          </td>
        </tr>
        <tr class="border">
          <td class="border">
格子size
          </td>
          <td class="border">
grid-width
<br>
grid-height
          </td>
          <td class="border">
gridWidth=1~canvasWidth
<br>
gridhHeight=1~canvasHeight
          </td>
        </tr>
        <tr class="border">
          <td class="border">
要素
          </td>
          <td class="border">
1個の格子sizeの計算領域
          </td>
          <td class="border">
          </td>
        </tr>
        <tr class="border">
          <td class="border">
既知要素
          </td>
          <td class="border">
rgbaで条件を指定する要素
          </td>
          <td class="border">
a&gt;0
          </td>
        </tr>
        <tr class="border">
          <td class="border">
未知要素
          </td>
          <td class="border">
未知変数を定義する要素
          </td>
          <td class="border">
a=0
          </td>
        </tr>
        <tr class="border">
          <td class="border">
未知変数
          </td>
          <td class="border">
速度(u,v)
<br>
圧力p
          </td>
          <td class="border">
強連成@step1
<br>
弱連成の場合、SOR法等で緩和後の擬圧力分布から速度場を更新
          </td>
        </tr>
        <tr class="border">
          <td class="border">
未知変数の定義点
          </td>
          <td class="border">
集中格子（要素中心）
          </td>
          <td class="border" rowspan="2">
一般的な有限体積法によるflux考慮のFS法と比較して、
<br>
境界条件や保存量の評価手法が異なる
          </td>
        </tr>
        <tr class="border">
          <td class="border">
離散化手法
          </td>
          <td class="border">
<a href="../01_calc_simple/manual.html#span-out-fdm">有限差分法</a>
          </td>
        </tr>
        <tr class="border">
          <td class="border">
保存特性
          </td>
          <td class="border">
解の厳密さ（保存則の満足度）
          </td>
          <td class="border">
保存量を指標として表示
          </td>
        </tr>
        <tr class="border">
          <td class="border">
1要素の保存量
          </td>
          <td class="border">
連続の式
          </td>
          <td class="border">
c=0（有限体積法の場合、要素毎に成立）
          </td>
        </tr>
        <tr class="border">
          <td class="border">
全要素の保存量
          </td>
          <td class="border">
領域外境界の体積流出入量
          </td>
          <td class="border">
q=0（|q|&gt;1e-1で解が発散傾向）
          </td>
        </tr>
        <tr class="border">
          <td class="border">
計算対象の全領域
          </td>
          <td class="border">
全要素の計算領域
          </td>
          <td class="border">
1要素でp=0の不変を仮定できる十分な領域を取ることが望ましい
<br>
Re依存で領域不足の場合、保存量が拡大し、dt依存で解が発散する
          </td>
        </tr>
        <tr class="border">
          <td class="border">
領域外の境界条件
          </td>
          <td class="border">
(u,v,p)のNeumann条件
          </td>
          <td class="border">
境界の法線方向n
<br>
du/dn=dv/dn=dp/dn=0
          </td>
        </tr>
        <tr class="border">
          <td class="border">
既知要素の境界条件0
          </td>
          <td class="border">
(u,v)のDirichlet条件
<br>
pのNeumann条件
          </td>
          <td class="border">
(u,v)=(r/255,g/255)
<br>
dp/dn=0
<br>
境界位置が不正確
<br>
有限差分法の場合、粘性項のfluxが不正確
          </td>
        </tr>
        <tr class="border">
          <td class="border">
既知要素の境界条件1
<br>
<span class="run">Ver.1.7.0追加</span>
          </td>
          <td class="border">
(u,v)のNeumann条件
<br>
pのNeumann条件
          </td>
          <td class="border">
境界面の(u,v)を指定値として内側1点から仮想点に線形外挿
<br>
<span class="run">(u,v)=lerp(r/255,g/255)</span>
<br>
dp/dn=0
<br>
境界条件0より境界位置が厳密で全要素の保存量が改善
<br>
有限差分法の場合、粘性項のfluxが不正確
          </td>
        </tr>
        <tr class="border">
          <td class="border">
中間速度@step0.5
          </td>
          <td class="border">
圧力分布なしの速度場
          </td>
          <td class="border">
不連続が大きい場合、有限の領域境界で解が破綻しやすい
          </td>
        </tr>
        <tr class="border">
          <td class="border">
移流項scheme@step0.5
          </td>
          <td class="border">
1||3次精度の上流差分（非保存型）
          </td>
          <td class="border">
数値不安定な中心差分に数値粘性を付加
          </td>
        </tr>
        <tr class="border">
          <td class="border">
粘性項@step0.5
          </td>
          <td class="border">
2||4次精度の中心差分
          </td>
          <td class="border">
scheme=Order1||Order3
          </td>
        </tr>
        <tr class="border">
          <td class="border">
時間積分@step0.5
          </td>
          <td class="border">
2次精度のAdams-Bashforth法
          </td>
          <td class="border">
          </td>
        </tr>
        <tr class="border">
          <td class="border">
連続の式||圧力項@step1
          </td>
          <td class="border">
2次精度の中心差分
          </td>
          <td class="border">
<span class="clear">4次精度は未実装</span>
          </td>
        </tr>
        <tr class="border">
          <td class="border">
最適化
<br>
<span class="run">Ver.1.4.0追加</span>
          </td>
          <td class="border">
処理時間の低減
          </td>
          <td class="border">
差分式の演算
<br>
・除算を含む係数をまとめて乗算に変換
<br>
<br>
schemeの切替
<br>
・if文を削除（関数で切替）
<br>
<br>
境界条件の切替
<br>
・if文で切替（<span class="clear">関数で切替は未実装</span>）
<br>
<br>
境界位置の切替
<br>
・if文で切替（<span class="clear">関数で切替は未実装</span>）
<br>
<br>
solver
<br>
・COO形式<span class="run">⇒LIL形式</span>
          </td>
        </tr>
        <tr class="border">
          <td class="border" rowspan="3">
安定化
<br>
<span class="condition">Ver.1.13.0更新</span>
          </td>
          <td class="border">
解が発散時の対策
          </td>
          <td class="border">
時間刻みを小さくする
<br>
・流出境界で逆流が存在する場合、|Ndt|&gt;&gt;1
<br>
・非粘性に近い場合（Re無限大）、|Ndt|&gt;&gt;1
<br>
・粘性が支配的な場合（Re≒0）、|Ndt|&gt;&gt;<span class="condition">10</span>（<span class="clear">粘性項の陰解法は未実装</span>）
          </td>
        </tr>
        <tr class="border">
          <td class="border">
解がNaN時の対策
          </td>
          <td class="border">
閉じた領域が残存する場合、塗りつぶす
          </td>
        </tr>
        <tr class="border">
          <td class="border">
page未応答時の対策
          </td>
          <td class="border">
描画頻度を上げる
<br>
・格子sizeを大きくする
<br>
・Nntを小さくする
          </td>
        </tr>
      </tbody>
    </table>
<br>
    <table class="border">
      <caption>流れ場を記述する方程式</caption>
      <thead>
        <tr class="border">
          <th class="border">
項目
          </th>
          <th class="border">
内容
          </th>
          <th class="border">
実装
          </th>
        </tr>
      </thead>
      <tbody>
        <tr class="border">
          <td class="border">
Navier-Stokes方程式
          </td>
          <td class="border">
運動量保存の式
          </td>
          <td class="border">
移流項
<br>
圧力項（圧力勾配項）
<br>
粘性項
<br>
生成項（重力等の外力項）
          </td>
        </tr>
        <tr class="border">
          <td class="border">
Euler方程式
          </td>
          <td class="border">
粘性項なし（慣性が支配的⇒粘性を無視）
          </td>
          <td class="border">
Re無限大
          </td>
        </tr>
        <tr class="border">
          <td class="border">
Stokes方程式
          </td>
          <td class="border">
移流項なし（粘性が支配的⇒慣性を無視）
          </td>
          <td class="border">
Re≒0
          </td>
        </tr>
        <tr class="border">
          <td class="border">
Burgers方程式
<br>
移流拡散方程式
          </td>
          <td class="border">
圧力項なし（連続の式を無視）
          </td>
          <td class="border">
圧力分布なしの中間速度
          </td>
        </tr>
        <tr class="border">
          <td class="border">
移流方程式
          </td>
          <td class="border">
粘性項なし
<br>
圧力項なし
          </td>
          <td class="border">
Re無限大の中間速度
          </td>
        </tr>
        <tr class="border">
          <td class="border">
拡散方程式
          </td>
          <td class="border">
移流項なし
<br>
圧力項なし
          </td>
          <td class="border">
Re≒0の中間速度
          </td>
        </tr>
      </tbody>
    </table>
<br>
    <table class="border">
      <caption>URL-parameter</caption>
      <thead>
        <tr class="border">
          <th class="border">
項目
          </th>
          <th class="border">
内容
          </th>
          <th class="border">
実装
          </th>
        </tr>
      </thead>
      <tbody>
        <tr class="border">
          <td class="border">
nmax
<br>
<span class="run">Ver.1.12.0追加</span>
          </td>
          <td class="border">
描画更新の最大回数
          </td>
          <td class="border">
start~自動停止の間
          </td>
        </tr>
        <tr class="border">
          <td class="border">
testcase=-1~17
<br>
<span class="run">Ver.1.5.0追加</span>
<br>
<span class="condition">Ver.1.6.0追加</span>
<br>
<span class="selection">Ver.1.7.0追加</span>
<br>
<span class="jF">Ver.1.12.0追加
<br>
全data軽量化svg⇒png</span>
<br>
<span class="clear">Ver.1.14.0追加</span>
<br>
<span class="wF">Ver.1.15.0追加</span>
          </td>
          <td class="border">
test case
          </td>
          <td class="border">
<span class="wF">-1: backstep流れの再付着点距離の検証
<br>
・代表速さ=inlet平均速さ（redを指定）
<br>
・代表長さ=step高さ（Lyを設定）
<br>
・ReS=inlet平均速さ*step高さ/動粘度
<br>
・ReS=200,400,600に対して
<br>
・t&gt;&gt;100で評価する
<br>
・無次元の再付着点距離=約5,7,10（助走区間長=1、inlet未発達）
<br>
・無次元の再付着点距離=約6,9,11（助走区間長=3）
<br>
・以降、乱流遷移で再付着点距離が減少傾向
<br>
・実験も同様、流れ場が徐々に3次元化</span>
<br>
0: 左右の一様流
<br>
1: 上下の一様流
<br>
<span class="condition">2: 斜めの一様流</span>
<br>
3: 左右のKarman渦列（領域不足、Ly=3相当のRe）
<br>
<span class="condition">4: 上下のKarman渦列（同上）</span>
<br>
<span class="selection">5: 左右のKarman渦列（同上）</span>
<br>
<span class="selection">6: 上下のKarman渦列（同上）</span>
<br>
<span class="run">7: Hagen-Poiseuille流れ</span>
<br>
<span class="selection">8: cavity流れ（速度指定）</span>
<br>
<span class="selection">9: cavity流れ（圧力指定）</span>
<br>
10: cavity流れ（模擬条件）
<br>
<span class="condition">11: backstep流れ（領域不足、助走区間不足、Ly=2相当のReS）</span>
<br>
12: cavity+backstep流れ（解像度不足）
<br>
<span class="jF">13: 合流の一様流</span>
<br>
<span class="jF">14: 対称な合流（圧力分布なしの中間速度を表示）</span>
<br>
<span class="jF">15: 非対称な合流（同上）</span>
<br>
<span class="clear">16: 左右の不連続流（同上）</span>
<br>
<span class="clear">17: 上下の不連続流（同上）</span>
          </td>
        </tr>
      </tbody>
    </table>
<br>
    <table class="border">
      <caption>UI設定</caption>
      <thead>
        <tr class="border">
          <th class="border">
項目
          </th>
          <th class="border">
内容
          </th>
          <th class="border">
実装
          </th>
        </tr>
      </thead>
      <tbody>
        <tr class="border">
          <td class="border">
i=0~Ni-1
          </td>
          <td class="border">
x方向の要素index
          </td>
          <td class="border">
          </td>
        </tr>
        <tr class="border">
          <td class="border">
j=0~Nj-1
          </td>
          <td class="border">
y方向の要素index
          </td>
          <td class="border">
          </td>
        </tr>
        <tr class="border">
          <td class="border">
Ni=1~
          </td>
          <td class="border">
x方向の要素数
          </td>
          <td class="border">
Ni=ceil(canvasWidth/round(gridWidth))
          </td>
        </tr>
        <tr class="border">
          <td class="border">
Nj=1~
          </td>
          <td class="border">
y方向の要素数
          </td>
          <td class="border">
Nj=ceil(canvasHeight/round(gridHeight))
<br>
割り切れない場合、pre/post表示の座標に乖離あり
          </td>
        </tr>
        <tr class="border">
          <td class="border">
dx
<br>
<span class="clear">Ver.1.1.0変更</span>
          </td>
          <td class="border">
x方向の無次元grid刻み幅
          </td>
          <td class="border">
<span class="clear"><del>dx=1/Ni</del></span>
<br>
<span class="clear">dx=dy*round(gridWidth)/round(gridHeight)</span>
          </td>
        </tr>
        <tr class="border">
          <td class="border">
dy
<br>
<span class="clear">Ver.1.1.0変更</span>
<br>
<span class="run">Ver.1.10.0変更</span>
          </td>
          <td class="border">
y方向の無次元grid刻み幅
          </td>
          <td class="border">
<span class="clear"><del>dy=dx*round(gridHeight)/round(gridWidth)</del></span>
<br>
<span class="clear">dy=<span class="run">Ly</span>/Nj</span>
          </td>
        </tr>
        <tr class="border">
          <td class="border">
Lx
<br>
<span class="run">Ver.1.10.0追加</span>
          </td>
          <td class="border">
x方向の無次元全長
          </td>
          <td class="border">
Lx=dx*Ni
          </td>
        </tr>
        <tr class="border">
          <td class="border">
Ly
<br>
<span class="run">Ver.1.10.0追加</span>
          </td>
          <td class="border">
y方向の無次元全長
          </td>
          <td class="border">
代表長さ=1から換算
          </td>
        </tr>
        <tr class="border">
          <td class="border">
rgba=0~255
          </td>
          <td class="border">
pixelのRGBA
          </td>
          <td class="border">
要素左上のpixelを判定
<br>
a&gt;0 -> 既知要素
<br>
a=0 -> 未知要素
          </td>
        </tr>
        <tr class="border">
          <td class="border">
(u,v)=(r/255,g/255)
          </td>
          <td class="border">
無次元速度vector
          </td>
          <td class="border">
blackを含むr=g=0で壁指定
          </td>
        </tr>
        <tr class="border">
          <td class="border">
p
          </td>
          <td class="border">
無次元圧力
          </td>
          <td class="border">
p=0@b=255
<br>
b=255未定義時、右下の未知要素p=0
<br>
(u,v)の同時指定不可
          </td>
        </tr>
        <tr class="border">
          <td class="border">
t
          </td>
          <td class="border">
無次元時間
          </td>
          <td class="border">
          </td>
        </tr>
        <tr class="border">
          <td class="border">
Re
          </td>
          <td class="border">
Reynolds数
<br>
=慣性力/粘性力
<br>
=代表速さ*代表長さ/動粘度
          </td>
          <td class="border">
<del>y方向の全長=1と(u,v)から実際の問題に換算が必要
<br>
例）代表長さが全長の半分の場合、実際のReは指定値の半分</del>
<br>
<span class="run">Ver.1.10.0</span>以降、Lyと(u,v)から実際の問題に換算が必要
          </td>
        </tr>
        <tr class="border">
          <td class="border">
Ndt
<br>
<span class="selection">Ver.1.11.0追加</span>
          </td>
          <td class="border">
dtmaxの分割数
          </td>
          <td class="border">
<span class="selection">Ndt&lt;0の場合、CFL条件適応の時間刻みの時間発展</span>
          </td>
        </tr>
        <tr class="border">
          <td class="border">
dt
          </td>
          <td class="border">
時間発展の時間刻み
          </td>
          <td class="border">
dt=dtmax/<span class="selection">|Ndt|</span>
          </td>
        </tr>
        <tr class="border">
          <td class="border">
dtmax
<br>
<span class="condition">Ver.1.13.0更新</span>
          </td>
          <td class="border">
時間刻み最大値
          </td>
          <td class="border">
<span class="condition">dtmax=min(dtmax_CFL,dtmax_VNSA)</span>
          </td>
        </tr>
        <tr class="border">
          <td class="border">
dtmax_CFL
<br>
<span class="selection">Ver.1.11.0追加</span>
          </td>
          <td class="border">
CFL条件を満たす時間刻み最大値
          </td>
          <td class="border">
Ndt&ge;0 -> 固定dtmax_CFL=min(dx,dy)/1
<br>
<span class="selection">Ndt&lt;0 -> 可変dtmax_CFL=min(dx/(max(|u|)||1),dy/(max(|v|)||1))</span>
          </td>
        </tr>
        <tr class="border">
          <td class="border">
dtmax_VNSA
<br>
<span class="condition">Ver.1.13.0追加</span>
          </td>
          <td class="border">
拡散の安定条件を満たす時間刻み最大値
          </td>
          <td class="border">
<span class="condition">dtmax_VNSA=0.5*Re*min(dx*dx,dy*dy)</span>
          </td>
        </tr>
        <tr class="border">
          <td class="border">
Nnt=1~1000
<br>
<span class="run">Ver.1.12.0追加</span>
          </td>
          <td class="border">
描画更新の間隔
          </td>
          <td class="border">
dt基準
          </td>
        </tr>
        <tr class="border">
          <td class="border">
c
<br>
<span class="clear">Ver.1.3.0削除</span>
<br>
<span class="run">Ver.1.9.0復帰</span>
          </td>
          <td class="border">
1要素の保存量最大値
          </td>
          <td class="border">
<del><span class="clear">厳密な評価困難で流量qの指標で代替</span></del>
          </td>
        </tr>
        <tr class="border">
          <td class="border">
q
<br>
<span class="run">Ver.1.3.0追加</span>
          </td>
          <td class="border">
全要素の保存量
          </td>
          <td class="border">
2次精度の<a href="../01_calc_simple/manual.html#span-out-fdm-integral">数値積分</a>
          </td>
        </tr>
        <tr class="border">
          <td class="border">
start
          </td>
          <td class="border">
計算開始/再開button
          </td>
          <td class="border">
          </td>
        </tr>
        <tr class="border">
          <td class="border">
stop
          </td>
          <td class="border">
計算一時停止button
          </td>
          <td class="border">
          </td>
        </tr>
        <tr class="border">
          <td class="border">
scheme=Order1||Order3
          </td>
          <td class="border">
差分精度次数の選択
          </td>
          <td class="border">
order=1||3
          </td>
        </tr>
        <tr class="border">
          <td class="border">
scheme-a
<br>
<span class="run">Ver.1.17.0追加</span>
          </td>
          <td class="border">
数値粘性の適用率
          </td>
          <td class="border">
a=0 -> (order+1)次精度の中心差分
<br>
a=1 -> (order+0)次精度の上流差分
<br>
a=3 -> Kawamura-Kuwahara scheme@order=3
          </td>
        </tr>
        <tr class="border">
          <td class="border">
bound=境界条件0||1
<br>
<span class="run">Ver.1.7.0追加</span>
          </td>
          <td class="border">
既知要素の境界条件の種類
          </td>
          <td class="border">
          </td>
        </tr>
        <tr class="border">
          <td class="border">
k_arrow=<span class="run">-100~</span>100
<br>
<span class="run">Ver.1.15.0追加</span>
          </td>
          <td class="border">
post表示用
<br>
矢印のsize倍率=|k_arrow|
          </td>
          <td class="border">
<span class="run">k_arrow&gt;0の場合、矢印全体をre-size</span>
<br>
k_arrow&le;0の場合、矢印部分をre-size（終点基準）
<br>
<br>
矢印はcanvas中面に描画
<br>
矢印vector:=(u,v)
          </td>
        </tr>
        <tr class="border">
          <td class="border">
arrow-color
<br>
<span class="run">Ver.1.16.0追加</span>
          </td>
          <td class="border">
post表示用
<br>
矢印の色
          </td>
          <td class="border">
<span class="run">矢印の色:=black（固定）</span>
<br>
<br>
<span class="run">矢印の色（青～緑～黄～橙～赤）:=|velocity|（最低値～最高値）</span>
<br>
<br>
矢印の色（青～緑～黄～橙～赤）:=pressure（最低値～最高値）
<br>
・圧力分布なしの場合、黒色
<br>
・既知要素p=0（境界条件を未代入）
          </td>
        </tr>
        <tr class="border">
          <td class="border">
arrows=false||true
<br>
<span class="run">Ver.1.8.0追加</span>
          </td>
          <td class="border">
矢印のdownloadを有効化
          </td>
          <td class="border">
png出力はcanvas中面を出力（grid||矢印のみ）
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</body>

</html>
